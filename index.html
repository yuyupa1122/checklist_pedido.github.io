
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Checklist YUYUPA – Abastecimiento Semanal</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="color-scheme" content="light dark" />
  <style>
    html, body { height: 100%; }
    .qty-input::-webkit-outer-spin-button,
    .qty-input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    .qty-input[type=number] { -moz-appearance: textfield; }
  </style>
</head>
<body class="min-h-screen bg-gray-50 text-gray-900">
  <div class="max-w-5xl mx-auto p-4 sm:p-6">
    <header class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 mb-4">
      <h1 class="text-2xl sm:text-3xl font-bold">Checklist YUYUPA <span class="text-gray-500">– Abastecimiento semanal</span></h1>
      <div class="flex items-center gap-2">
        <button id="resetBtn" class="px-3 py-2 rounded-xl border bg-white hover:bg-gray-100">Limpiar</button>
        <button id="exportCsvBtn" class="px-3 py-2 rounded-xl border bg-white hover:bg-gray-100">Exportar CSV</button>
        <button id="sendBtn" class="px-4 py-2 rounded-xl bg-emerald-600 text-white hover:bg-emerald-700">Enviar por correo</button>
      </div>
    </header>

    <section class="mb-4 grid sm:grid-cols-3 gap-3">
      <div class="col-span-2">
        <label class="block text-sm font-medium text-gray-700 mb-1">Correo de destino</label>
        <input id="targetEmail" type="email" class="w-full rounded-xl border p-3" value="saladroom593@gmail.com, stalin520@gmail.com, gracealeto@gmail.com" placeholder="compras@yuyupa.ec, admin@yuyupa.ec" />
        <p class="text-xs text-gray-500 mt-1">Puedes poner varios correos separados por coma.</p>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Semana / Observación</label>
        <input id="note" type="text" class="w-full rounded-xl border p-3" placeholder="Semana 42 / Sucursal Centro" />
      </div>
    </section>

    <details class="mb-4 bg-yellow-50 border border-yellow-200 rounded-xl p-3">
      <summary class="cursor-pointer font-semibold">¿Cómo funciona?</summary>
      <ul class="list-disc pl-5 mt-2 text-sm text-yellow-900">
        <li>Toca el ítem para marcarlo y usa +/- o escribe cantidad.</li>
        <li><strong>Sobra</strong>: anota cuánto queda en local para decidir cuánto comprar.</li>
        <li>Botón <strong>Enviar por correo</strong>: abre tu app de correo con el resumen listo.</li>
        <li>Opcional: integra <code>Formspree/EmailJS</code> para enviar sin abrir correo (ver código).</li>
      </ul>
    </details>

    <div class="mb-3 flex flex-wrap gap-2" id="categoryChips"></div>

    <div id="list" class="grid md:grid-cols-2 gap-3"></div>

    <template id="itemRowTpl">
      <div class="rounded-2xl border bg-white p-3 shadow-sm flex items-center gap-3">
        <input type="checkbox" class="h-5 w-5 shrink-0 mt-1 accent-emerald-600 item-check" />
        <div class="flex-1">
          <div class="flex items-center justify-between gap-2">
            <div>
              <div class="font-semibold leading-tight item-name">Item</div>
              <div class="text-xs text-gray-500 item-meta">Categoría • Unidad</div>
            </div>
            <div class="flex items-center gap-2">
              <button class="px-3 py-2 rounded-xl border hover:bg-gray-50 btn-dec" aria-label="disminuir">–</button>
              <input type="number" min="0" step="1" class="w-16 text-center rounded-xl border p-2 qty-input item-qty" value="0" />
              <button class="px-3 py-2 rounded-xl border hover:bg-gray-50 btn-inc" aria-label="aumentar">+</button>
            </div>
          </div>
          <div class="mt-2 grid grid-cols-2 gap-2">
            <div>
              <label class="text-xs text-gray-500">Sobra</label>
              <input type="number" min="0" step="1" class="w-full rounded-xl border p-2 qty-input item-leftover" placeholder="0" />
            </div>
            <div>
              <label class="text-xs text-gray-500">Nota</label>
              <input type="text" class="w-full rounded-xl border p-2 item-note" placeholder="Observación" />
            </div>
          </div>
        </div>
      </div>
    </template>
  </div>

  <script>
    const INVENTORY = {items: [{"name": "Pollo", "category": "Proteínas", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Tocino", "category": "Proteínas", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Jamón", "category": "Proteínas", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Burritos", "category": "Proteínas", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Mezcla para dorilocos", "category": "Proteínas", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Queso cheddar líquido", "category": "Lácteos", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Queso cheddar laminado", "category": "Lácteos", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Queso mozzarella", "category": "Lácteos", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Crema de queso", "category": "Lácteos", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Yogurt", "category": "Lácteos", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Tortilla de maíz", "category": "Tortillas, panes y snacks", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Pan chivata", "category": "Tortillas, panes y snacks", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Doritos rojos", "category": "Tortillas, panes y snacks", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Doritos verdes", "category": "Tortillas, panes y snacks", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Nachos pequeños", "category": "Tortillas, panes y snacks", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Nachos grandes", "category": "Tortillas, panes y snacks", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Lechuga", "category": "Verduras", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Tomate", "category": "Verduras", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Zanahoria", "category": "Verduras", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Pimientos", "category": "Verduras", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Cebolla", "category": "Verduras", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Champiñones", "category": "Verduras", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Papaya", "category": "Frutas", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Piña", "category": "Frutas", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Plátano", "category": "Frutas", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Manzana", "category": "Frutas", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Frutilla", "category": "Frutas", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Maracuyá", "category": "Pulpas", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Mora", "category": "Pulpas", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Zumo de limón", "category": "Pulpas", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Maíz dulce", "category": "Granos y legumbres", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Choclo desgranado", "category": "Granos y legumbres", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Chochos", "category": "Granos y legumbres", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Tostado", "category": "Granos y legumbres", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Salsa chipotle", "category": "Salsas y ajíes", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Salsa teriyaki", "category": "Salsas y ajíes", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Salsa de la casa", "category": "Salsas y ajíes", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Salsa pesto", "category": "Salsas y ajíes", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Salsa pomodoro", "category": "Salsas y ajíes", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Salsa de vegetales asados", "category": "Salsas y ajíes", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Ají de vegetales asados", "category": "Salsas y ajíes", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Ají rojo dulce", "category": "Salsas y ajíes", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Ají de jalapeño con piña", "category": "Salsas y ajíes", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Sirope de mora", "category": "Salsas y ajíes", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Sal", "category": "Especias", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Azúcar", "category": "Especias", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Pimienta", "category": "Especias", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Vinagre", "category": "Especias", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Aceite", "category": "Especias", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Ajonjolí", "category": "Especias", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Maní", "category": "Especias", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Granola", "category": "Especias", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Jugos (cuántos quedan)", "category": "Bebidas", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Pulpas (mora, maracuyá, limón)", "category": "Bebidas", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Coca Cola grande", "category": "Bebidas", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Agua 1L", "category": "Bebidas", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Agua 500 ml", "category": "Bebidas", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Colas pequeñas", "category": "Bebidas", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Empanadas", "category": "Otros", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Humitas / quimbolitos", "category": "Otros", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Platos N°8", "category": "Plásticos", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Bandejas para burritos", "category": "Plásticos", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Platos para ensaladas", "category": "Plásticos", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Platos para nachos", "category": "Plásticos", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Hojas para envolver wraps", "category": "Plásticos", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Fundas plásticas para wraps", "category": "Plásticos", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Fundas para llevar", "category": "Plásticos", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Botellas plásticas", "category": "Plásticos", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Tenedores desechables", "category": "Plásticos", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Cuchillos desechables", "category": "Plásticos", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Servilletas", "category": "Plásticos", "unit": "", "default_qty": 0, "default_leftover": 0}, {"name": "Guantes desechables", "category": "Plásticos", "unit": "", "default_qty": 0, "default_leftover": 0}] };

    const state = {
      items: [],
      filter: "Todas",
    };

    function init() {
      state.items = INVENTORY.items.map((it, idx) => ({
        id: idx+1,
        name: it.name,
        category: it.category || "General",
        unit: it.unit || "",
        qty: it.default_qty || 0,
        leftover: (typeof it.default_leftover === 'number' ? it.default_leftover : 0),
        note: "",
        checked: false,
      }));

      renderCategoryChips();
      renderList();
      bindHandlers();
      restoreFromStorage();
    }

    function categories() {
      const set = new Set(state.items.map(i => i.category || "General"));
      return ["Todas", ...Array.from(set).sort((a,b)=>a.localeCompare(b))];
    }

    function renderCategoryChips() {
      const wrap = document.getElementById("categoryChips");
      wrap.innerHTML = "";
      for (const cat of categories()) {
        const btn = document.createElement("button");
        btn.textContent = cat;
        btn.className = "px-3 py-1.5 rounded-full border " + (state.filter===cat ? "bg-emerald-600 text-white border-emerald-600" : "bg-white hover:bg-gray-50");
        btn.onclick = () => { state.filter = cat; renderList(); };
        wrap.appendChild(btn);
      }
    }

    function filteredItems() {
      return state.items.filter(i => state.filter==="Todas" || i.category===state.filter);
    }

    function renderList() {
      const list = document.getElementById("list");
      list.innerHTML = "";
      const tpl = document.getElementById("itemRowTpl");
      for (const it of filteredItems()) {
        const node = tpl.content.cloneNode(true);
        const row = node.querySelector(".rounded-2xl");
        row.dataset.id = it.id;

        node.querySelector(".item-name").textContent = it.name;
        node.querySelector(".item-meta").textContent = (it.category || "General") + (it.unit ? " • " + it.unit : "");

        const check = node.querySelector(".item-check");
        const qty = node.querySelector(".item-qty");
        const left = node.querySelector(".item-leftover");
        const note = node.querySelector(".item-note");
        qty.value = it.qty ?? 0;
        left.value = it.leftover ?? 0;
        note.value = it.note ?? "";
        check.checked = !!it.checked;

        node.querySelector(".btn-inc").onclick = () => { qty.value = (+qty.value||0) + 1; qty.dispatchEvent(new Event('change')); };
        node.querySelector(".btn-dec").onclick = () => { qty.value = Math.max(0, (+qty.value||0) - 1); qty.dispatchEvent(new Event('change')); };

        check.onchange = (e) => update(it.id, { checked: e.target.checked });
        qty.onchange = (e) => update(it.id, { qty: Math.max(0, +e.target.value||0), checked: (+e.target.value||0) > 0 ? true : it.checked });
        left.onchange = (e) => update(it.id, { leftover: Math.max(0, +e.target.value||0) });
        note.onchange = (e) => update(it.id, { note: e.target.value });

        list.appendChild(node);
      }
      persist();
    }

    function update(id, patch) {
      const i = state.items.findIndex(x => x.id===id);
      if (i>=0) {
        state.items[i] = { ...state.items[i], ...patch };
        persist();
      }
    }

    function summary() {
      const selected = state.items.filter(i => i.checked || (i.qty && i.qty>0));
      const lines = [];
      lines.push("Checklist YUYUPA – Abastecimiento semanal");
      const note = document.getElementById("note").value.trim();
      if (note) lines.push("Nota: " + note);
      lines.push("");
      let lastCat = null;
      for (const it of selected) {
        if (it.category !== lastCat) {
          lines.push("[" + it.category + "]");
          lastCat = it.category;
        }
        lines.push(`- {it.name}: {it.qty||0} {it.unit||""}` + (it.leftover? ` (sobra: {it.leftover})`:"") + (it.note? ` — {it.note}`:""));
      }
      lines.push("");
      const totalItems = selected.length;
      lines.push("Total ítems: " + totalItems);
      return lines.join("\n");
    }

    function persist() {
      const payload = {
        v: 1,
        items: state.items,
        filter: state.filter,
        note: document.getElementById("note").value || "",
        targetEmail: document.getElementById("targetEmail").value || "",
      };
      localStorage.setItem("yuyupa_checklist", JSON.stringify(payload));
    }

    function restoreFromStorage() {
      try {
        const payload = JSON.parse(localStorage.getItem("yuyupa_checklist") || "null");
        if (payload && payload.v===1) {
          state.items = payload.items || state.items;
          state.filter = payload.filter || "Todas";
          document.getElementById("note").value = payload.note || "";
          document.getElementById("targetEmail").value = payload.targetEmail || "";
          renderCategoryChips();
          renderList();
        }
      } catch (e) {}
    }

    function exportCsv() {
      const headers = ["categoria","item","unidad","cantidad","sobra","nota"];
      const rows = state.items.filter(i => i.checked || (i.qty && i.qty>0)).map(i => [
        quote(i.category), quote(i.name), quote(i.unit), i.qty||0, i.leftover||0, quote(i.note)
      ]);
      const csv = [headers.join(","), ...rows.map(r=>r.join(","))].join("\n");
      const blob = new Blob([csv], {type: "text/csv;charset=utf-8;"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "yuyupa_checklist.csv";
      document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    }

    function quote(s) {
      s = (s??"").toString();
      if (s.includes(",") || s.includes("\\")) {
        return '"' + s.replaceAll('"','""') + '"';
      }
      return s;
    }

    function sendEmail() {
      const to = (document.getElementById("targetEmail").value||"").replace(/;/g,",").split(",").map(s=>s.trim()).filter(Boolean).join(",");
      const body = encodeURIComponent(summary());
      const subject = encodeURIComponent("YUYUPA – Abastecimiento semanal");
      const mailto = "mailto:" + encodeURIComponent(to) + "?subject=" + subject + "&body=" + body;
      window.location.href = mailto;
    }

    function bindHandlers() {
      document.getElementById("sendBtn").onclick = sendEmail;
      document.getElementById("exportCsvBtn").onclick = exportCsv;
      document.getElementById("resetBtn").onclick = () => {
        if (confirm("¿Borrar selecciones y cantidades?")) {
          for (const it of state.items) {
            it.qty = 0; it.leftover = 0; it.note = ""; it.checked = false;
          }
          document.getElementById("note").value = "";
          renderList();
          persist();
        }
      };
      document.getElementById("note").addEventListener("change", persist);
      document.getElementById("targetEmail").addEventListener("change", persist);
    }

    // --- Optional: send via Formspree (no backend) ---
    // 1) Create a Formspree form and replace YOUR_FORM_ID below.
    // 2) Then call sendViaFormspree() instead of sendEmail().
    async function sendViaFormspree() {
      const formId = "YOUR_FORM_ID";
      const payload = {
        to: (document.getElementById("targetEmail").value||"").trim(),
        note: document.getElementById("note").value || "",
        summary: summary(),
        items: state.items.filter(i => i.checked || (i.qty && i.qty>0)),
      };
      const res = await fetch("https://formspree.io/f/" + formId, {
        method: "POST",
        headers: { "Accept": "application/json", "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      });
      if (res.ok) alert("Enviado correctamente");
      else alert("No se pudo enviar");
    }

    // --- Optional: EmailJS (requiere keys públicas) ---
    // emailjs.init("PUBLIC_KEY"); // luego emailjs.send("service_id","template_id", {...})

    init();
  </script>
</body>
</html>
